# Implementation Plan: Git Repository Cleanup Tool

**Branch**: `001-repo-cleanup-tool` | **Date**: 2025-12-16 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-repo-cleanup-tool/spec.md`

## Summary

Build a comprehensive Git repository cleanup CLI tool that helps developers maintain clean repositories by removing merged branches, stale tags, and orphaned elements. The tool prioritizes safety through confirmation prompts, provides an excellent TUI experience using Bubbletea, and leverages goroutines for optimal performance. Architecture follows command/subcommand pattern (e.g., `git-gone branches`, `git-gone tags list`).

## Technical Context

**Language/Version**: Go 1.21+ (as specified in go.mod)  
**Primary Dependencies**:
- `github.com/spf13/cobra` - CLI command structure, flags, help, autocompletion
- `github.com/charmbracelet/bubbletea` - TUI framework for interactive elements
- `github.com/charmbracelet/bubbles` - Pre-built TUI components (list, spinner, etc.)
- `github.com/charmbracelet/lipgloss` - TUI styling
- `github.com/koki-develop/go-fzf` - Fuzzy finder (existing dependency)

**Storage**: N/A (operates on git repository, no persistent storage)  
**Testing**: `go test` with table-driven tests  
**Target Platform**: Linux, macOS, Windows (cross-platform single binary)  
**Project Type**: Single CLI application  
**Performance Goals**: 
- Startup < 100ms
- Branch listing < 1s for 1000 branches
- Non-blocking UI during git operations

**Constraints**: 
- Single binary, no runtime dependencies
- Must work offline (except self-update)
- Memory efficient for large repositories

**Scale/Scope**: Individual developer workstations, repositories with up to 10,000 branches

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Evidence |
|-----------|--------|----------|
| I. Code Quality | ✅ Pass | Functional Go code, single responsibility per command, explicit error handling |
| II. Testing Standards | ✅ Pass | Integration tests for all CLI commands planned |
| III. UX Consistency | ✅ Pass | Emoji prefixes, confirmation prompts, safe defaults defined |
| IV. Performance | ✅ Pass | Goroutines for async ops, < 100ms startup goal, streaming data |

**Technical Constraints Compliance**:
- ✅ Go language
- ✅ Cobra for CLI
- ✅ Single binary build
- ✅ Cross-platform support
- ✅ Git plugin integration

## Project Structure

### Documentation (this feature)

```text
specs/001-repo-cleanup-tool/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output (CLI interface contracts)
└── tasks.md             # Phase 2 output (/speckit.tasks command)
```

### Source Code (repository root)

```text
.
├── main.go                    # Entry point
├── cmd/
│   ├── root.go               # Root command, global flags
│   ├── branches.go           # branches command (list, clean merged/gone)
│   ├── tags.go               # tags command with subcommands
│   ├── version.go            # version command
│   └── selfupdate.go         # self-update command
├── internal/
│   ├── git/
│   │   ├── repository.go     # Git repository operations
│   │   ├── branch.go         # Branch detection and operations
│   │   ├── tag.go            # Tag detection and operations
│   │   └── remote.go         # Remote operations
│   ├── tui/
│   │   ├── selector.go       # Interactive selection TUI (Bubbletea)
│   │   ├── confirm.go        # Confirmation prompts
│   │   ├── spinner.go        # Progress indicators
│   │   └── styles.go         # Lipgloss styles
│   └── updater/
│       └── github.go         # GitHub release checker and updater
├── go.mod
├── go.sum
└── Makefile
```

**Structure Decision**: Single project structure. All source code in `cmd/` (Cobra commands) and `internal/` (business logic). Follows Go standard project layout with clear separation between CLI layer and domain logic.

## Command Structure

```text
git-gone
├── branches              # Default command (branch cleanup)
│   ├── (default)        # Interactive branch cleanup
│   ├── --all, -a        # Select all candidates
│   ├── --force, -f      # Skip confirmation
│   └── --unmerged, -u   # Include unmerged branches
├── tags                  # Tag management
│   ├── list             # List stale tags
│   ├── clean            # Interactive tag cleanup
│   └── --force, -f      # Skip confirmation
├── version              # Show version info
├── self-update          # Update to latest release
└── help                 # Auto-generated by Cobra
```

## Complexity Tracking

> No violations - design follows constitution principles.

| Aspect | Decision | Rationale |
|--------|----------|-----------|
| Bubbletea vs go-fzf | Use both | go-fzf for simple selection, Bubbletea for richer TUI experiences |
| Goroutines | For git operations | Git fetch, branch detection run in background |
| Internal packages | Encapsulation | Prevent external import of implementation details |
